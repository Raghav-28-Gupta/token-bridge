// Prisma schema for Bridge Indexer - Simplified for Testing

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model BridgeEvent {
  id String @id @default(uuid())

  // Event identification
  txHash    String
  logIndex  Int
  eventType String // Deposit, Withdraw

  // Chain info
  chainId     Int
  blockNumber Int
  blockHash   String
  timestamp   DateTime

  // Event data
  token     String
  sender    String? // Only for Deposit
  recipient String
  amount    String
  nonce     Int

  // Related chain info
  sourceChainId Int? // For Withdraw events
  targetChainId Int? // For Deposit events

  // Metadata
  createdAt DateTime @default(now())

  @@unique([txHash, logIndex])
  @@index([chainId, blockNumber])
  @@index([eventType])
  @@index([token])
  @@index([recipient])
  @@index([sender])
  @@index([nonce])
  @@index([timestamp])
}

model Transfer {
  id String @id @default(uuid())

  // Transfer identification
  depositTxHash  String
  withdrawTxHash String?

  // Chain info
  sourceChainId Int
  targetChainId Int

  // Transfer details
  token     String
  sender    String
  recipient String
  amount    String
  nonce     Int

  // Status
  status String // pending, completed, failed

  // Block info
  depositBlock  Int
  withdrawBlock Int?

  // Timestamps
  depositTime  DateTime
  withdrawTime DateTime?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([depositTxHash])
  @@index([sourceChainId, targetChainId])
  @@index([status])
  @@index([recipient])
  @@index([sender])
  @@index([nonce])
  @@index([token])
}

model ChainSync {
  id String @id @default(uuid())

  // Chain info
  chainId   Int    @unique
  chainName String

  // Sync state
  lastBlockNumber Int
  lastBlockHash   String
  lastSyncedAt    DateTime @default(now())

  // Stats
  totalEvents Int @default(0)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([chainId])
}
